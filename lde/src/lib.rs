//! This crate contains a framework for low-degree tests (LDTs).

#![no_std]

mod naive;

use core::fmt::Debug;
pub use naive::*;

extern crate alloc;

use p3_field::{ExtensionField, Field, TwoAdicField};
use p3_matrix::dense::RowMajorMatrix;

/// Performs low-degree extensions over (possibly trivial) cosets of multiplicative subgroups of the
/// domain, `Dom`.
pub trait TwoAdicLDE<Val, Dom>
where
    Val: Field,
    Dom: ExtensionField<Val> + TwoAdicField,
{
    /// The result type. Typically this will be `EF`, but it may also be a compressed encoding of
    /// the subspace of `EF` that may be produced by LDEs.
    type Res: Into<Dom> + Copy + Send + Sync + Debug;

    /// Given a batch of polynomials, each defined by `2^k` evaluations over the subgroup generated
    /// by `EF::primitive_root_of_unity(k)`, compute their evaluations over the (possibly trivial)
    /// coset `shift H`, where `H` is the subgroup generated by
    /// `EF::primitive_root_of_unity(k + added_bits)`.
    fn lde_batch(&self, polys: RowMajorMatrix<Val>, added_bits: usize)
        -> RowMajorMatrix<Self::Res>;
}

/// A specialization of `TwoAdicLDE` where that evaluates polynomials over a multiplicative
/// subgroup of the domain `Dom`, or in other words, a trivial coset thereof.
pub trait TwoAdicSubgroupLDE<Val, Dom>: TwoAdicLDE<Val, Dom>
where
    Val: Field,
    Dom: ExtensionField<Val> + TwoAdicField,
{
}

/// A specialization of `TwoAdicLDE` where that evaluates polynomials over a nontrivial coset of a
/// multiplicative subgroup of the domain `Dom`.
pub trait TwoAdicCosetLDE<Val, Dom>: TwoAdicLDE<Val, Dom>
where
    Val: Field,
    Dom: ExtensionField<Val> + TwoAdicField,
{
    fn shift(&self, lde_bits: usize) -> Dom;
}

//! Poseidon1 implementation for BabyBear.
//!
//! Constants sourced from HorizenLabs:
//! <https://github.com/HorizenLabs/poseidon2/blob/main/plain_implementations/src/poseidon/poseidon_instance_babybear.rs>

use p3_monty_31::{
    GenericPoseidon1LinearLayersMonty31, PartialRoundBaseParameters, PartialRoundParameters,
    Poseidon1ExternalLayerMonty31, Poseidon1InternalLayerMonty31,
};
use p3_poseidon::{Poseidon, PoseidonConstants};

use crate::{BabyBear, BabyBearParameters};

/// Internal (partial round) layer for BabyBear Poseidon1.
pub type Poseidon1InternalLayerBabyBear<const WIDTH: usize> =
    Poseidon1InternalLayerMonty31<BabyBearParameters, WIDTH, BabyBearPoseidon1Parameters>;

/// External (full round) layer for BabyBear Poseidon1.
pub type Poseidon1ExternalLayerBabyBear<const WIDTH: usize> =
    Poseidon1ExternalLayerMonty31<BabyBearParameters, WIDTH>;

/// Degree of the chosen permutation polynomial for BabyBear, used as the Poseidon1 S-Box.
///
/// As p - 1 = 15 * 2^{27} neither 3 nor 5 satisfy gcd(p - 1, D) = 1.
/// Instead we use the next smallest available value, namely 7.
const BABYBEAR_S_BOX_DEGREE: u64 = 7;

/// The Poseidon1 permutation for BabyBear.
///
/// Acts on arrays of the form `[BabyBear; WIDTH]` or `[BabyBear::Packing; WIDTH]`.
pub type Poseidon1BabyBear<const WIDTH: usize> = Poseidon<
    BabyBear,
    Poseidon1ExternalLayerBabyBear<WIDTH>,
    Poseidon1InternalLayerBabyBear<WIDTH>,
    WIDTH,
    BABYBEAR_S_BOX_DEGREE,
>;

/// Generic Poseidon1 linear layers for BabyBear.
///
/// Can act on `[A; WIDTH]` for any ring implementing `Algebra<BabyBear>`.
pub type GenericPoseidon1LinearLayersBabyBear =
    GenericPoseidon1LinearLayersMonty31<BabyBearParameters, BabyBearPoseidon1Parameters>;

/// Parameters for the Poseidon1 internal layer on BabyBear.
#[derive(Debug, Clone, Default)]
pub struct BabyBearPoseidon1Parameters;

impl PartialRoundBaseParameters<BabyBearParameters, 16> for BabyBearPoseidon1Parameters {}
impl PartialRoundBaseParameters<BabyBearParameters, 24> for BabyBearPoseidon1Parameters {}
impl PartialRoundParameters<BabyBearParameters, 16> for BabyBearPoseidon1Parameters {}
impl PartialRoundParameters<BabyBearParameters, 24> for BabyBearPoseidon1Parameters {}

/// MDS matrix for width-16 Poseidon1 on BabyBear.
#[rustfmt::skip]
pub const BABYBEAR_POSEIDON1_MDS_16: [[BabyBear; 16]; 16] = BabyBear::new_2d_array([
    [
        0x6ed88b54, 0x365c29f9, 0x029047ae, 0x0340f575, 0x68418255, 0x315e4e40, 0x51596faa, 0x71183465,
        0x2d036fca, 0x09e4fa24, 0x38e00966, 0x13e81974, 0x60f6dafc, 0x3c664116, 0x2e2b9d4b, 0x6c5f6689,
    ],
    [
        0x4a1d7fc9, 0x6506dfb7, 0x2f49702b, 0x3ebaafe9, 0x718fc5d2, 0x14dcbeed, 0x27a38245, 0x528238e5,
        0x10663404, 0x2a504978, 0x0b027c2e, 0x4bdd7226, 0x001ebc59, 0x52555194, 0x148df9b7, 0x013587d5,
    ],
    [
        0x03a74096, 0x5b791ccd, 0x2e3a2688, 0x26b936dc, 0x0a0df4c3, 0x4a1e89d8, 0x07a37b58, 0x3ff10121,
        0x4912f3d0, 0x0e5cbd22, 0x0086832d, 0x5bc8209b, 0x0ecaa423, 0x0c8b360e, 0x542abb63, 0x198e5ede,
    ],
    [
        0x2ba24027, 0x5c61cbe2, 0x15dabd0c, 0x58763be5, 0x70a28315, 0x41a8f9fb, 0x3786bc6d, 0x19ca59f8,
        0x42185a03, 0x48223bcf, 0x190d6883, 0x086269de, 0x3630ddef, 0x2c0dbdd3, 0x2c07ad23, 0x29561d75,
    ],
    [
        0x2db3561a, 0x349aabc3, 0x0aeb611d, 0x32c2bd61, 0x38527028, 0x1483f37b, 0x3b28e234, 0x5a2762d4,
        0x47c2d9d7, 0x372c5808, 0x54d14bd6, 0x49690d33, 0x0e015d17, 0x6aabc1ec, 0x3070eff3, 0x20b26c05,
    ],
    [
        0x2e19ba8d, 0x0d23450a, 0x2e5d9599, 0x57521a71, 0x0fe30b31, 0x2d125f10, 0x0bcd2b75, 0x1c5c0995,
        0x13538cc1, 0x3e89bab1, 0x0ecd2c52, 0x4a242476, 0x3bd8f726, 0x6f61a168, 0x4be24d17, 0x3612cac7,
    ],
    [
        0x2d922f25, 0x6edf0857, 0x33af4716, 0x724e5171, 0x2a7361d2, 0x123ecf2e, 0x2275c912, 0x21f75377,
        0x0b4a2d3c, 0x61940261, 0x335fa739, 0x3e18aca4, 0x1255c968, 0x0627c139, 0x0c870799, 0x1a271c86,
    ],
    [
        0x3722cccf, 0x3e2ac9f8, 0x3c6899ac, 0x6ced5ba0, 0x767999cd, 0x12fdf314, 0x284d52da, 0x010fa38b,
        0x14e29a97, 0x58b4180e, 0x19b6c4ac, 0x722e27d3, 0x39a050e6, 0x4d05c08a, 0x3dbffefa, 0x61f01023,
    ],
    [
        0x4237a659, 0x4947e8c3, 0x069342f5, 0x15171937, 0x554eef00, 0x2ff329af, 0x0a5129f2, 0x634b85d7,
        0x2a8adb36, 0x0c41318c, 0x5ac8ad85, 0x75823102, 0x49a8c8f4, 0x37b4dc23, 0x48383ddd, 0x2917cc4a,
    ],
    [
        0x64ded285, 0x2cf24480, 0x48a51fa3, 0x3f6d1fa6, 0x67fb2b58, 0x4ee85b14, 0x0185c875, 0x5c7a942d,
        0x700e51a2, 0x15aff07d, 0x303754a2, 0x18a3e923, 0x28f104b7, 0x4d81102d, 0x26eee317, 0x2624abc9,
    ],
    [
        0x1cabd063, 0x2100450e, 0x1f3be9dd, 0x2a76b379, 0x3f18d12a, 0x0bb69105, 0x04d8a7ac, 0x1faded71,
        0x0b2d86dd, 0x5b4fd3ea, 0x0d7f56e4, 0x4c934264, 0x00578cbc, 0x4ac335a4, 0x6de618f4, 0x12430d70,
    ],
    [
        0x69a43964, 0x27be8c04, 0x05bbbf28, 0x6a6fd5f2, 0x029ff4a2, 0x7480e7d2, 0x6ebd8697, 0x505ac2f2,
        0x42198491, 0x3e22dde8, 0x19b3ffc9, 0x1c029b85, 0x3c83bd24, 0x5d48ee0c, 0x51db5088, 0x6a044125,
    ],
    [
        0x033e3e9f, 0x320cdce6, 0x42ceb3a3, 0x2c39ef78, 0x129f22c0, 0x038ce048, 0x200c7aa6, 0x37297a16,
        0x6957af38, 0x3efaaf35, 0x47086768, 0x65017cbd, 0x3e52dd44, 0x632cdfec, 0x1e21dc74, 0x02b68bcf,
    ],
    [
        0x2526f6b9, 0x18cdaeca, 0x1a64dd5e, 0x0ed814ac, 0x32a9eb40, 0x2f276e0d, 0x30c6664b, 0x0ecfbdf7,
        0x6e70acbc, 0x1df04c92, 0x44090fa0, 0x69e69133, 0x1bca435a, 0x0cb43110, 0x19f651ca, 0x3ea3be87,
    ],
    [
        0x032bf42c, 0x72b82f03, 0x2b56b081, 0x377703d9, 0x49cadd18, 0x3f7a6788, 0x1be5dac5, 0x1c81f75b,
        0x6983b960, 0x067493e8, 0x4a4c05c9, 0x04dbd1a7, 0x2d30836d, 0x67454db1, 0x70de7fb4, 0x331eb4b8,
    ],
    [
        0x574bceed, 0x3c1e600e, 0x3a1b91b1, 0x69369cf9, 0x5e68d7ff, 0x2ddcd8d4, 0x5aff0a6d, 0x7068c4fc,
        0x0fcb3bfd, 0x133838c7, 0x0bac1e88, 0x13ee81b1, 0x2eecf375, 0x1450e2a1, 0x474d780d, 0x3a9c651c,
    ],
]);

/// Round constants for width-16 Poseidon1 on BabyBear.
///
/// Layout: [initial_full (4 rounds), partial (13 rounds), terminal_full (4 rounds)].
#[rustfmt::skip]
pub const BABYBEAR_POSEIDON1_RC_16: [[BabyBear; 16]; 21] = BabyBear::new_2d_array([
    // Initial full rounds (4)
    [
        0x22d14fc7, 0x47743d29, 0x677f35c3, 0x3ae46df5, 0x24f86039, 0x4eb76fe3, 0x463c658a, 0x06ee674e,
        0x21e71f9b, 0x50cd5cec, 0x5959fa83, 0x10a5b894, 0x0cf4d6db, 0x32b95009, 0x40299d0f, 0x31762364,
    ],
    [
        0x77a932b9, 0x4d5f9435, 0x585e5f8d, 0x68852880, 0x186d0ef0, 0x0bc8e16b, 0x33efc152, 0x4818fbb4,
        0x60b89701, 0x217f693a, 0x242e7dd9, 0x2c602bd2, 0x3da5d2a9, 0x44d38735, 0x00b8f704, 0x6d897b7f,
    ],
    [
        0x26d51110, 0x4b9eaa24, 0x59f60b8a, 0x481b4e03, 0x4898afc8, 0x21a0b0cc, 0x2b03c2df, 0x0fea4ba0,
        0x4bf2e3e8, 0x2073fdff, 0x3285abb7, 0x3ac0d1e9, 0x13d65258, 0x16b7a570, 0x45bcb00f, 0x5ba25311,
    ],
    [
        0x0f78e922, 0x294613f3, 0x1c377a1d, 0x2c19a8f6, 0x46e75290, 0x34bdbe27, 0x103e09a6, 0x32f00a1c,
        0x193d8310, 0x48f5804b, 0x6866d66a, 0x05e6320a, 0x6250e5ba, 0x0f64c9de, 0x27f3a9c3, 0x367b028e,
    ],
    // Partial rounds (13)
    [
        0x3062eba8, 0x66794e00, 0x3a8857de, 0x311769e5, 0x269b55e6, 0x5962fc4d, 0x26e2a5a0, 0x1f6aec92,
        0x66ff3568, 0x011c60cd, 0x2347af5a, 0x57bb56a4, 0x64de8246, 0x70f587ad, 0x4a91fd65, 0x3279477b,
    ],
    [
        0x6ded73c5, 0x75418e3f, 0x002a0229, 0x21fbe33c, 0x206b9591, 0x4133e248, 0x3e0d0cc5, 0x1e2351fd,
        0x078e4519, 0x30a9d69e, 0x7689ab87, 0x0ae7a298, 0x029923cb, 0x024a2b1b, 0x1d60dbdf, 0x3d8af2b3,
    ],
    [
        0x36174f16, 0x397bf853, 0x478f1171, 0x202b95f5, 0x22a49e9a, 0x593a115d, 0x65f5a466, 0x56fdefeb,
        0x0aa188c1, 0x5982426b, 0x71f6cb38, 0x594a711d, 0x2033eea8, 0x0c20b93b, 0x4873d752, 0x413cdb68,
    ],
    [
        0x1020fb7b, 0x55642c83, 0x4c3ca55e, 0x5cc9d020, 0x01bf4025, 0x5d53256f, 0x12110fe3, 0x5f325b00,
        0x05ed0223, 0x6f73787e, 0x4250e6af, 0x05a1f50f, 0x5cedfe10, 0x5da8026b, 0x086fe6ee, 0x29e60bc0,
    ],
    [
        0x1c725c10, 0x1c3f0e56, 0x3bd7fb18, 0x24d8e7d6, 0x502b1331, 0x1570f4c6, 0x7060c4b4, 0x2822b9fe,
        0x379b4036, 0x3c9ab0d8, 0x35bd29cf, 0x3353ba79, 0x72bc5629, 0x2e553ca6, 0x23131dd6, 0x46e96cd6,
    ],
    [
        0x4d65f5dc, 0x3fe8d06f, 0x6a4c8483, 0x6a9d46ea, 0x51b39333, 0x773dd4bb, 0x75472220, 0x03536ac5,
        0x3fc93d6f, 0x1bd92d69, 0x6620b70f, 0x26e72902, 0x25eebb36, 0x66edfccc, 0x37779413, 0x60e28ba3,
    ],
    [
        0x741d0b77, 0x60f2d017, 0x23a25699, 0x2f063482, 0x1c768088, 0x11733e6b, 0x65d84305, 0x11c4ca51,
        0x0fd5b6d7, 0x6469045d, 0x40257c38, 0x4c1d66ac, 0x3a86fb76, 0x6545288f, 0x00947328, 0x40d6abcb,
    ],
    [
        0x6f5d7715, 0x09801dd4, 0x389b74f8, 0x23461c1a, 0x1ae8ae39, 0x111cc3cb, 0x5b08fb1f, 0x5d2826af,
        0x59c2918b, 0x392ece30, 0x56cb9b3b, 0x66bc00b1, 0x33d307df, 0x69624a18, 0x66eb09dc, 0x6597fd4c,
    ],
    [
        0x612fbfbd, 0x32c37391, 0x6b8bde71, 0x77384d19, 0x6580ce59, 0x169b7580, 0x6616ad73, 0x3c1887de,
        0x75e3f2e5, 0x3ef08074, 0x59f70462, 0x27012115, 0x2ecc37d6, 0x52b25aa4, 0x0e71eb68, 0x6a5b543d,
    ],
    [
        0x2f47db02, 0x6b426d43, 0x22e2a257, 0x05689f5d, 0x53000206, 0x62174579, 0x41ee708e, 0x4c69f70e,
        0x3a403a2c, 0x74a944ff, 0x0c5369ae, 0x08360919, 0x20502e46, 0x3aaba434, 0x6a3f85ff, 0x04a9a527,
    ],
    [
        0x3b985df9, 0x5ed46d10, 0x4b48f8aa, 0x3365ee9c, 0x688d45f5, 0x52f52e90, 0x48bfad48, 0x0f5474cb,
        0x03b31034, 0x23c4e6fb, 0x37835e64, 0x24e8a57b, 0x700e9dd8, 0x44a95941, 0x3a495982, 0x3dd606f4,
    ],
    [
        0x6b990415, 0x5f419361, 0x18992a1f, 0x50d0225b, 0x16959009, 0x75c0bf50, 0x0b95ce3d, 0x10deaf8f,
        0x36ca8803, 0x52d760ce, 0x49a1d323, 0x1cee5d28, 0x517d182a, 0x445e59d5, 0x0f9dd8a7, 0x5e137128,
    ],
    [
        0x70c68bd4, 0x4e452a12, 0x42c2636b, 0x5b5fa86c, 0x317568b1, 0x03e62c70, 0x1bb59265, 0x1baf7be7,
        0x6376d40e, 0x548d4eca, 0x75e7d9f1, 0x4f9f6c94, 0x412cbbc5, 0x580e0d79, 0x21bb6865, 0x3f50966b,
    ],
    // Terminal full rounds (4)
    [
        0x3522ced6, 0x2a1988c9, 0x63cc080d, 0x2b1f3d4c, 0x4506613e, 0x60102247, 0x33a8ed0c, 0x4918947e,
        0x4528a692, 0x1092a39e, 0x3b1f852a, 0x2691e16d, 0x36b79fd6, 0x108673bf, 0x66addb91, 0x0f453f41,
    ],
    [
        0x48b36260, 0x6f748480, 0x429817b2, 0x23073ebf, 0x4dbba065, 0x4cdb2356, 0x72c494a2, 0x4733a44d,
        0x76a19165, 0x6c7872c8, 0x4bc245e1, 0x6d1efcfa, 0x29be57e1, 0x5eef5121, 0x0fda3d38, 0x2873e796,
    ],
    [
        0x10e8340b, 0x1bd00ac6, 0x4b8db5b7, 0x61fe659f, 0x247777c9, 0x0468bdea, 0x0e9f932b, 0x4d35799d,
        0x0449265f, 0x45e3b326, 0x220818ed, 0x686090e1, 0x69361c44, 0x0ab186f2, 0x348a8c1a, 0x77a8cb46,
    ],
    [
        0x776673b7, 0x3764f92a, 0x4b49f079, 0x068c7915, 0x6ae894f1, 0x3ca29798, 0x27f0ccd0, 0x51bb1b3b,
        0x1f45baaa, 0x22a18c6a, 0x5172d793, 0x46560975, 0x12ac2c28, 0x4ec30409, 0x0f41009b, 0x71ea9382,
    ],
]);

/// MDS matrix for width-24 Poseidon1 on BabyBear.
#[rustfmt::skip]
pub const BABYBEAR_POSEIDON1_MDS_24: [[BabyBear; 24]; 24] = BabyBear::new_2d_array([
    [
        0x19191a7d, 0x6cbe083c, 0x0b589971, 0x3be4046a, 0x2c837497, 0x61c4fa1e, 0x3d45f6db, 0x679624bc,
        0x5f59f3da, 0x62cda2fe, 0x567b01b2, 0x389daccb, 0x5522ba84, 0x71e3475e, 0x5f147d86, 0x1d7e0433,
        0x4450fc40, 0x6a1d0eee, 0x258885f3, 0x0ec7eb27, 0x584ae718, 0x3e4a6f51, 0x0671c21b, 0x418f03e4,
    ],
    [
        0x61a34efe, 0x593f2d08, 0x5a5599f9, 0x246030d1, 0x1210627a, 0x2e5a37f0, 0x23c9e547, 0x02071da9,
        0x49852008, 0x6e9fae9f, 0x26d98222, 0x13538a35, 0x61216f13, 0x3552bef4, 0x0bbe8d33, 0x0bf02cff,
        0x0991e1c3, 0x73dccd52, 0x4f5a8c64, 0x2a9f0e56, 0x60786ad6, 0x5ce8c0fe, 0x3a9d048a, 0x3e1e5cd2,
    ],
    [
        0x1866d4b4, 0x2e2f9a97, 0x127340e3, 0x6faf4fa8, 0x75575b7f, 0x447bb0f8, 0x069efa67, 0x610a18ac,
        0x0edf2bd3, 0x559135f8, 0x5b912991, 0x43f2c76f, 0x73cd6b24, 0x13c3df30, 0x10a57d3d, 0x01603b41,
        0x6e04d184, 0x40cdb676, 0x0134bac6, 0x0b88cf23, 0x31e557c7, 0x5a7cba48, 0x58fbabe3, 0x1b03e09e,
    ],
    [
        0x4dc75c69, 0x63f7f41b, 0x27c89e9e, 0x09c1b7ad, 0x004a124f, 0x691a8125, 0x6924edbd, 0x29cdb1aa,
        0x56bf4b5c, 0x2703c2c7, 0x19107ae4, 0x30c37517, 0x253c03bd, 0x623725c0, 0x37054961, 0x48ae028b,
        0x52d40d06, 0x3e7d0eb6, 0x1d40d7dd, 0x29f924ee, 0x37083357, 0x59c995bc, 0x501e3fe0, 0x19024c7d,
    ],
    [
        0x04377f31, 0x0a4a0017, 0x1f17ba47, 0x54276fdf, 0x1ad767cd, 0x4c397b7d, 0x45dad135, 0x1166cd59,
        0x10032dd4, 0x26250b6c, 0x52802c2e, 0x53f6862f, 0x73fe56cf, 0x1f33e178, 0x02c41117, 0x2ccc0227,
        0x44f9db11, 0x439fa653, 0x08c1efb8, 0x0dee8126, 0x157974cf, 0x3ed232d6, 0x2f2ad7ef, 0x2b3a4348,
    ],
    [
        0x24802d4b, 0x0e3bf555, 0x094764ce, 0x1e5558cd, 0x300bd275, 0x41c2f5b5, 0x5fd9db22, 0x5681e3e6,
        0x5e17625b, 0x2990a7d2, 0x146901e4, 0x09b26110, 0x451759ad, 0x4eb06038, 0x61c9ed3c, 0x074e4cb7,
        0x51b17024, 0x507e4bb3, 0x487cdc37, 0x629c4f2c, 0x28f8531b, 0x271f4983, 0x038a6d28, 0x2c0aacd8,
    ],
    [
        0x15545583, 0x101a363d, 0x15126e8a, 0x4e1ed8a5, 0x53d4f4d1, 0x3d07b7b3, 0x073ea0d9, 0x60998306,
        0x00ffb607, 0x3e71b599, 0x730ea91f, 0x5fe87f4b, 0x49510355, 0x2ce9fd2a, 0x0b9451b8, 0x319c006d,
        0x669ab96c, 0x71ee9e09, 0x5dc07b5e, 0x4611ee0d, 0x5022239a, 0x5a3ca2a3, 0x3f6830ca, 0x4928eae1,
    ],
    [
        0x284e8831, 0x1cdef1a6, 0x3797153a, 0x42f4735d, 0x38cce46e, 0x1ef113c2, 0x5af0700d, 0x69ef808a,
        0x3b9a08a3, 0x6aae8b15, 0x1bca8baf, 0x43fe3d1a, 0x3f08abbc, 0x13f6e4fa, 0x72948221, 0x53bd5821,
        0x76f6675e, 0x3b26093c, 0x6e4ead9f, 0x11cd8332, 0x7035588c, 0x2575bb3d, 0x51f93a72, 0x22dad1b9,
    ],
    [
        0x1120f193, 0x06ff8b82, 0x54b835cf, 0x3dc53b9e, 0x4d181e81, 0x7218c243, 0x11231c2b, 0x062fdc55,
        0x2e2ae16d, 0x16d13882, 0x46f856e3, 0x3827488e, 0x7737cf0a, 0x620a9582, 0x38a1cae9, 0x150b8797,
        0x506bd8aa, 0x47d6929c, 0x3f9205fd, 0x164ecbbf, 0x23d5093c, 0x0e9fde93, 0x562a2e48, 0x713a8433,
    ],
    [
        0x5bab57ce, 0x005075f9, 0x3c9d0507, 0x2d25f9cd, 0x4cdf7499, 0x694cac91, 0x65c21198, 0x329c7d0b,
        0x021d84c3, 0x6a61dfb1, 0x4ab97480, 0x19f2d1bd, 0x35381b5b, 0x0da575ff, 0x08afd461, 0x0fade176,
        0x5b815cc2, 0x644290b2, 0x4ef463e7, 0x6ea5993e, 0x61b7b10b, 0x7081130d, 0x3d683910, 0x6860542b,
    ],
    [
        0x1d7214bd, 0x367bf2b0, 0x48b48241, 0x1017b7be, 0x059453ab, 0x277337ec, 0x56277c87, 0x677bb976,
        0x24190c2f, 0x2c717e0b, 0x59e2a73d, 0x4bf46e75, 0x270ebff5, 0x2e9a07a6, 0x47b4f2cc, 0x54d12ed3,
        0x2bb16505, 0x745c060a, 0x3e0a397e, 0x2c5d842a, 0x03034fd5, 0x38cef2b1, 0x31927212, 0x423c33ef,
    ],
    [
        0x4e7dfc7a, 0x037378f9, 0x1881ed25, 0x6af37772, 0x18ce1693, 0x4626f02f, 0x70732dcd, 0x0942f572,
        0x65df735e, 0x5ad72db4, 0x699fe9cc, 0x35ab9cd7, 0x758a62eb, 0x0ae5ff35, 0x342e0c42, 0x1d3f9a7e,
        0x2feedf99, 0x55e3734c, 0x56d75a3b, 0x040dfb91, 0x0361ad6c, 0x5a6aeb5d, 0x0de01972, 0x33328e03,
    ],
    [
        0x13501f54, 0x204885fb, 0x43c85d92, 0x4a97c740, 0x424beb1b, 0x2012116a, 0x49694aa2, 0x247703cc,
        0x4ba4bc45, 0x132cdb95, 0x3cafc24a, 0x241870e3, 0x1e582d31, 0x27ba0403, 0x1aa8fff0, 0x6eedc92c,
        0x35d4decf, 0x2e722b3f, 0x36358015, 0x062d8da5, 0x4a0ff259, 0x41c55848, 0x67e4ea95, 0x40f69a47,
    ],
    [
        0x0bba6386, 0x6f7efbff, 0x3d8fed85, 0x264b3587, 0x2c1d569b, 0x04b218e8, 0x3a939d97, 0x6b3a6c39,
        0x29c25fb7, 0x6ffd0c02, 0x5e38ab0e, 0x0e3e636a, 0x324551bd, 0x19ac1d52, 0x6389c4b1, 0x15c77366,
        0x3b746f85, 0x5e1eea00, 0x732b79a2, 0x73e81e4c, 0x2172727c, 0x58e8098c, 0x46c6e6c2, 0x07e9d643,
    ],
    [
        0x5eca9a37, 0x304d75f1, 0x2294c0bd, 0x3d7ab743, 0x2636b5d5, 0x0f890758, 0x0afa5a3d, 0x41e4665b,
        0x0b4c63fc, 0x1112be28, 0x0e9162b1, 0x6a00fcaa, 0x6cac103b, 0x153d5d75, 0x05ac5be5, 0x06519cce,
        0x66941f1c, 0x1abeed57, 0x05f3b38b, 0x2dbe8560, 0x28c7ffb3, 0x06eed76a, 0x5404eed2, 0x28464e68,
    ],
    [
        0x6937aa7d, 0x20cd555a, 0x41d20da1, 0x163d4a11, 0x4da2443d, 0x08c6343c, 0x5ec6eb45, 0x5e1b7c27,
        0x29c7fd8e, 0x268f1b7f, 0x014ab25d, 0x1892edb1, 0x413222ca, 0x548a31a0, 0x765d9087, 0x64de0f9a,
        0x3d0e6471, 0x7513a7ae, 0x3112d543, 0x2375ab22, 0x270250d0, 0x025b8b09, 0x574ca016, 0x02e4bb01,
    ],
    [
        0x41786ccf, 0x41f0df6c, 0x43107975, 0x11ca0a05, 0x4b3d6afe, 0x5ad09060, 0x3da8de0a, 0x1573ad5b,
        0x32384d13, 0x2e2cc2a4, 0x257be6c0, 0x246dd39b, 0x1d43bce2, 0x399670ed, 0x1c703658, 0x042b4e65,
        0x2fcd523a, 0x58d576a5, 0x3f70e99e, 0x2c08c7e5, 0x048463f2, 0x30c41673, 0x327e05f6, 0x13476bbf,
    ],
    [
        0x14971335, 0x2a9db91a, 0x48ceae5d, 0x0eab20e2, 0x627c3e30, 0x55697057, 0x0ab66b04, 0x51da9659,
        0x4e7e6fba, 0x5c911a08, 0x093289b9, 0x5a95b9d6, 0x47a94672, 0x2b251d75, 0x334521f0, 0x32c685fb,
        0x3431a4c5, 0x3a5c7f94, 0x319109af, 0x4c921429, 0x5dd16726, 0x60ea6e89, 0x47dc57e2, 0x2705784a,
    ],
    [
        0x2eadb949, 0x6152ba98, 0x17e543ad, 0x1e65633a, 0x162f1877, 0x4b07c2b4, 0x5fc3caef, 0x45357bef,
        0x65694da5, 0x4f35206b, 0x099d6860, 0x02ce0797, 0x7032c8f9, 0x21eb00e8, 0x5cb8810d, 0x1ae59be7,
        0x48df9450, 0x620314f3, 0x37539abb, 0x477b9153, 0x72d3c7be, 0x6ca27c72, 0x767a7651, 0x191a449a,
    ],
    [
        0x64e2a38c, 0x280cc6af, 0x28bf710a, 0x76bfe2c0, 0x40ed3108, 0x3beabed2, 0x18cfa693, 0x3672bd08,
        0x3d0b66fb, 0x59af6345, 0x76d6cf74, 0x0b4f4043, 0x082538a9, 0x5680b41f, 0x73d88c5a, 0x1a038c65,
        0x25b16b46, 0x40266a1f, 0x401fa170, 0x2c44ad35, 0x3c6e516d, 0x2d5ca9b3, 0x485ebe47, 0x3cbad540,
    ],
    [
        0x1a317281, 0x03e74eb2, 0x1569d934, 0x0494659c, 0x034f41c3, 0x00b2f8a2, 0x5d7e821b, 0x2bb1d834,
        0x06b36470, 0x2a42f149, 0x73e9fe13, 0x0d401689, 0x2f0b0fdc, 0x6cb6443c, 0x670e3987, 0x410c9579,
        0x4b8fa592, 0x67d14ddc, 0x58c63aae, 0x33f6ac7b, 0x62496614, 0x5913b1ec, 0x338ed582, 0x4d4f4f02,
    ],
    [
        0x19dfa11b, 0x005524e2, 0x5f7574d0, 0x5c5b3588, 0x0ee563ab, 0x05930821, 0x4c4c668e, 0x5a02d1c5,
        0x33e4965c, 0x5b79d5c0, 0x730ca318, 0x2ce70f7b, 0x65611461, 0x6af41f50, 0x3a851c9d, 0x38225964,
        0x45f49cd7, 0x0516405e, 0x63d9dbad, 0x4fbce612, 0x1f30cbb0, 0x47320ea7, 0x5c5a1db7, 0x344524d6,
    ],
    [
        0x305f18aa, 0x4fefce1d, 0x2dd60db5, 0x37e7edb0, 0x33590038, 0x5ba76f30, 0x370a8395, 0x29114d66,
        0x0ca70423, 0x64591365, 0x384f8781, 0x300190ae, 0x32abb521, 0x399cb85f, 0x5bb899ef, 0x68e000f3,
        0x1ab3e268, 0x5cf5235f, 0x2b567559, 0x02e26480, 0x5df459ca, 0x2f379c3e, 0x5db69b04, 0x565b8f83,
    ],
    [
        0x137f7ff7, 0x2dd419c1, 0x4c4af6e7, 0x49e58f6c, 0x16263dba, 0x694a7845, 0x01840406, 0x1f89c640,
        0x1cd737aa, 0x58881e16, 0x462928d6, 0x2490dea3, 0x0bf92538, 0x37607a3d, 0x60321d26, 0x34118d9e,
        0x1b9743bb, 0x018b4aad, 0x362d15da, 0x4cbb87c1, 0x384ae3c2, 0x48ce88f7, 0x27a25e4f, 0x47ef48c5,
    ],
]);

/// Round constants for width-24 Poseidon1 on BabyBear.
///
/// Layout: [initial_full (4 rounds), partial (21 rounds), terminal_full (4 rounds)].
#[rustfmt::skip]
pub const BABYBEAR_POSEIDON1_RC_24: [[BabyBear; 24]; 29] = BabyBear::new_2d_array([
    // Initial full rounds (4)
    [
        0x75c89df8, 0x0af90431, 0x39e877bf, 0x18a5a8cd, 0x588e9a95, 0x16760b26, 0x026ff4a4, 0x2326df32,
        0x5a0b7c6f, 0x37d3973d, 0x1e5bc883, 0x59d3664a, 0x677f8a14, 0x64a3389e, 0x0d81d503, 0x77f51a78,
        0x1fc66dca, 0x13a094e3, 0x5d410ff1, 0x2383e213, 0x4f1144c3, 0x1ee540c8, 0x097edb05, 0x2c17a521,
    ],
    [
        0x66927671, 0x76626203, 0x1de486e8, 0x440c19f5, 0x20bbb67a, 0x2d4f79b0, 0x55b64ceb, 0x6712fbb4,
        0x24a3ec8a, 0x3b6062d5, 0x265abe23, 0x3b6fb81b, 0x43ddb4af, 0x49a5c4a8, 0x64581fc3, 0x77b795f1,
        0x1e918db8, 0x550e2c6a, 0x6b3571c8, 0x3609bf61, 0x46ae6e8f, 0x41fe0f80, 0x20420c1a, 0x0e95ad8a,
    ],
    [
        0x1b48deb1, 0x122ac59f, 0x0252c4a7, 0x2696a2c4, 0x01b232cf, 0x5c26d56b, 0x405535be, 0x20cc2fe6,
        0x1c16804d, 0x5fa5a4b8, 0x579729ad, 0x63e11b88, 0x5601d544, 0x3eeeaa1a, 0x4dfd202b, 0x4fa5da37,
        0x2118e7fc, 0x3eb830dd, 0x169ee87b, 0x2bd97286, 0x22865c3e, 0x6aaa6429, 0x29e0f68d, 0x6aca023a,
    ],
    [
        0x4d02be5e, 0x4f170e62, 0x5cc04ba7, 0x20655f92, 0x6a216eea, 0x7685bdbd, 0x332f989c, 0x57a66733,
        0x0719b431, 0x2f19a5c2, 0x5191f27f, 0x0e38bd91, 0x1c5abcda, 0x1da9f1bf, 0x42b01881, 0x5bf52e0f,
        0x4dc17cb8, 0x1d4688d6, 0x18e0160d, 0x54841116, 0x6b381bc9, 0x5c4a838c, 0x0e3dc983, 0x71c18d85,
    ],
    // Partial rounds (21)
    [
        0x71902c5e, 0x1654566c, 0x38b6f3a0, 0x35a19789, 0x2adf05e2, 0x07d01f0d, 0x02677f73, 0x385f532a,
        0x3e2fb2ac, 0x4e88c53b, 0x1e370587, 0x4e64e63c, 0x5942f756, 0x16944480, 0x711cc845, 0x76a93011,
        0x6c978579, 0x68f3467f, 0x47df3684, 0x09001f22, 0x3c1d9746, 0x70796779, 0x3b0bcbc9, 0x64665dab,
    ],
    [
        0x55eb1733, 0x3a240c5c, 0x5a4445ac, 0x3623eb7e, 0x6c1a9a42, 0x0a024e58, 0x44097942, 0x240878ef,
        0x3f507e57, 0x68b9393f, 0x43163825, 0x6d71852f, 0x5937ffff, 0x564b7092, 0x60d0dcb4, 0x414e0bf2,
        0x754a4cd6, 0x4edd0db2, 0x341f2761, 0x6da77d03, 0x6f157bce, 0x436d5397, 0x5501d7ab, 0x310b522f,
    ],
    [
        0x0ab56164, 0x150e3635, 0x0a7e3bc1, 0x05fac2a2, 0x68f51ab3, 0x1f03a3cf, 0x398e133a, 0x0f5d1399,
        0x5f29a526, 0x6cea6946, 0x1dca5af8, 0x5c06e542, 0x1665a8f2, 0x4b950256, 0x6ad5b666, 0x68e13aff,
        0x3c118567, 0x70ef24e6, 0x08fe6bb2, 0x77610aee, 0x140b4090, 0x12a59e03, 0x43376c38, 0x5cc0ffc8,
    ],
    [
        0x1b05d461, 0x50cd7eb1, 0x320b07e2, 0x24cfbcfc, 0x12bb2eec, 0x33169cde, 0x5f7ea3ec, 0x3f690e4c,
        0x2f47b8cd, 0x32d5e526, 0x3493e551, 0x07eac5d0, 0x111bfa27, 0x2f667258, 0x4c1c06d2, 0x6cd4b86c,
        0x30702542, 0x53d64e17, 0x7143e320, 0x47e038ee, 0x6871b994, 0x4113c042, 0x240af147, 0x5cde3214,
    ],
    [
        0x600fd4c2, 0x17a79c40, 0x43600bcc, 0x158238e7, 0x23082895, 0x53b32037, 0x583dd7e9, 0x1c2966ec,
        0x4f1c4aa2, 0x5e004513, 0x3b80fd92, 0x4cfed7fe, 0x62679264, 0x59abcafe, 0x4ddde884, 0x45535ec3,
        0x6a446628, 0x238b231e, 0x307d9f5a, 0x1128d0a2, 0x6ff378d4, 0x2cd023e3, 0x2f1d7c11, 0x4c10f8f9,
    ],
    [
        0x6bd45d5c, 0x74c89ea9, 0x33cb1c8b, 0x2c94a9ce, 0x3816b43d, 0x0e65a71e, 0x5e38c082, 0x6427f754,
        0x3bcce6ef, 0x6ea9c00e, 0x510a8434, 0x30063591, 0x06620981, 0x4beaf035, 0x4be4a698, 0x5ca330ec,
        0x33d54bf7, 0x316d226b, 0x3fe68690, 0x54e0d88e, 0x197cc4e9, 0x23c98f88, 0x299beb0c, 0x1c598f09,
    ],
    [
        0x772a2f2d, 0x28f39a58, 0x15c6d916, 0x5482d960, 0x1bcfe651, 0x17da1dbc, 0x4ae31a82, 0x3d1fb87a,
        0x10e59612, 0x59fff611, 0x7151fd1f, 0x04308067, 0x538af856, 0x31ec4b46, 0x5ca7e0e1, 0x014f24bc,
        0x34801c56, 0x400f2575, 0x42c0be20, 0x3fef7fd5, 0x40e16c35, 0x39a29264, 0x5139e92e, 0x6243e0e4,
    ],
    [
        0x356f27cc, 0x022c022e, 0x47511780, 0x28cc6078, 0x358b8d3d, 0x45f840fa, 0x615d96d5, 0x4e68d893,
        0x761e8520, 0x3ae0bc8d, 0x4d793ea9, 0x461c98dd, 0x0e6ae09e, 0x2473818a, 0x027d0ea1, 0x1e37b4fc,
        0x5a9b918e, 0x1af57d91, 0x16b2e255, 0x3e968bb0, 0x025fff84, 0x4a0ae3b6, 0x196ea9cc, 0x492f54d7,
    ],
    [
        0x21dd4a08, 0x63d6a965, 0x0d8d0c0c, 0x4f797854, 0x1ddd249b, 0x48ea3e56, 0x2028b394, 0x59ba09f9,
        0x73e9f78e, 0x14d3b6cb, 0x095b67e2, 0x5b97fccb, 0x4ae9fd70, 0x1c3d8daf, 0x592bb255, 0x459d8bb0,
        0x53284952, 0x62d219ff, 0x085b04e1, 0x292a4f83, 0x33ab42f3, 0x3b4848d7, 0x35b3b4e3, 0x2b104210,
    ],
    [
        0x36bc80a0, 0x23bc9027, 0x5d3a8ec7, 0x0b24aed6, 0x0ede5278, 0x5e5305a8, 0x39ac900a, 0x05dc1627,
        0x4294fabf, 0x6de5d842, 0x2a826d22, 0x1f30553c, 0x340b8c1b, 0x05b2b5d4, 0x752b7fd1, 0x1ee6d240,
        0x63125d49, 0x09fe5b3e, 0x05f70546, 0x13eb2cbd, 0x0d833c10, 0x5a629eec, 0x5a7fd158, 0x0eb52380,
    ],
    [
        0x560ad5c4, 0x29645160, 0x1170c734, 0x1822aac9, 0x217db6d3, 0x2e21c8d3, 0x606c5e6a, 0x75faa8f5,
        0x3094fa7e, 0x21b00a43, 0x4bb30480, 0x498991be, 0x28b20b19, 0x5c3d4d5f, 0x0b992d6a, 0x2607ef95,
        0x24188fae, 0x3bf8a077, 0x33f06cbf, 0x2cd92b31, 0x057d5b1b, 0x344f5403, 0x74b78582, 0x1f3d6a54,
    ],
    [
        0x5f1e1ae8, 0x6136a9a2, 0x470c5e78, 0x02ad2fca, 0x4cd3a6bb, 0x05b4f5c1, 0x20436bea, 0x1bed9ec7,
        0x1f29cc65, 0x1417eaa3, 0x0ba88347, 0x0a65070c, 0x03217e79, 0x3e5f5253, 0x60bb876e, 0x320e4cec,
        0x53b2c52e, 0x3e1d6eff, 0x687a3e07, 0x112d32bc, 0x5af9296f, 0x2cded641, 0x6ecc492b, 0x45bd2f2c,
    ],
    [
        0x5068b70b, 0x2563dc0f, 0x47e5ec52, 0x6e316d9b, 0x770839b4, 0x4fecdeaa, 0x20e2248a, 0x257fa6ed,
        0x21abc9d3, 0x4aaae270, 0x17e21621, 0x70d18ab2, 0x4a23443e, 0x169492c3, 0x627575d6, 0x4bcf6471,
        0x070d29e0, 0x75fbfe05, 0x08e3b575, 0x582caf96, 0x0ad360ea, 0x53e6e93d, 0x5ce70e60, 0x68b4d9c8,
    ],
    [
        0x665572ef, 0x02d7409a, 0x645cdaf7, 0x1a6ffc30, 0x1cdb2768, 0x681b647b, 0x2744d691, 0x51749894,
        0x1fa88ff1, 0x3b11764e, 0x71fec668, 0x12ad4534, 0x51ce85bf, 0x2fa22845, 0x4279a18a, 0x6436c1c4,
        0x00ac710b, 0x64aa70d4, 0x6cb3f64d, 0x73215a9e, 0x1e0d8c6a, 0x43cba3a4, 0x207f2305, 0x3b06e336,
    ],
    [
        0x3e1b5bb9, 0x02392281, 0x18b48bd7, 0x0ed07feb, 0x50fd2ce1, 0x27016dbd, 0x57328674, 0x474cb312,
        0x77168659, 0x6adbaa3a, 0x6910fad6, 0x1443e8c4, 0x263c7e3e, 0x034b3bcb, 0x1bdfbbff, 0x0d60038e,
        0x57283b50, 0x06989f09, 0x53e02e93, 0x0f36babc, 0x1d11c437, 0x34c59005, 0x0e84eb31, 0x76503e52,
    ],
    [
        0x5172219b, 0x187801e0, 0x484aead8, 0x27658b1c, 0x29264a97, 0x3dce14e1, 0x35996177, 0x5d5371b7,
        0x6ec08900, 0x5d816715, 0x20cfbffa, 0x613f7c59, 0x0569fcff, 0x0761a9cb, 0x2cfbcf11, 0x085eea02,
        0x4860f9f0, 0x4d205005, 0x57f328bd, 0x1a650f78, 0x46ce7839, 0x770a894b, 0x1c0e9cb6, 0x6e0ca41a,
    ],
    [
        0x0552da59, 0x594dec6b, 0x2aab23ed, 0x60c6eb54, 0x033206e3, 0x0c7a8237, 0x56a98019, 0x5479f680,
        0x0c51522a, 0x35d2c421, 0x69a6d90b, 0x5e7946e4, 0x6b48ddca, 0x728e2313, 0x14dad2af, 0x3947f321,
        0x67bd011f, 0x60c4f777, 0x472591d6, 0x32731626, 0x70a23d5b, 0x151b6c47, 0x6a67fb25, 0x2fe0c49e,
    ],
    [
        0x54f4561b, 0x15704ee4, 0x16f90bb9, 0x3be1690c, 0x76c1febb, 0x50a35164, 0x509717e0, 0x0355f8d3,
        0x668309fd, 0x54efe9b0, 0x49578bc5, 0x02fa220b, 0x2699c296, 0x5b07ec6a, 0x3df439cb, 0x6fa4b39c,
        0x09e690d7, 0x0bbce5c4, 0x6a106fd9, 0x1c13ac7f, 0x1347d8fe, 0x4f5e5b3e, 0x6b5802b7, 0x62d98682,
    ],
    [
        0x5a98822d, 0x5f84702e, 0x3126f240, 0x5a1aff1a, 0x77b04e66, 0x48c685c3, 0x355f8209, 0x2e739ce1,
        0x1adf9544, 0x1b327099, 0x0ce1a5a0, 0x1129ee7e, 0x5b334254, 0x4d1d8f66, 0x23c29e16, 0x63ac7ba7,
        0x513cb4e4, 0x52edd435, 0x4580818e, 0x55516239, 0x628cf778, 0x5eebf087, 0x15def2ec, 0x581ee8ce,
    ],
    [
        0x6b4345c5, 0x62ab4957, 0x4af89e0f, 0x4424f30c, 0x23ad1768, 0x665a9fd6, 0x1c0b5ae1, 0x65abddb8,
        0x7039a4b0, 0x21c65f02, 0x539f7cdc, 0x05ad0446, 0x4aae4ae6, 0x258bc9e4, 0x12e4cd47, 0x5a8e8499,
        0x21ccbdef, 0x1aee7336, 0x622564eb, 0x5e6d5bbc, 0x48c2117a, 0x418c1333, 0x6afb386a, 0x0c5b7812,
    ],
    [
        0x565753d9, 0x59a7ea4f, 0x37dd5860, 0x5bf14251, 0x56398160, 0x20cbf536, 0x1e49ee8c, 0x30e66c4d,
        0x32357c88, 0x595c244d, 0x7464a56d, 0x3a31384e, 0x3d3273be, 0x14d339cb, 0x5044a65c, 0x1cd80ac0,
        0x2d6ae173, 0x5bfd70f8, 0x05a66375, 0x29500b8c, 0x08d07343, 0x45bec74b, 0x045faaef, 0x6e763fd3,
    ],
    // Terminal full rounds (4)
    [
        0x51aa9c1a, 0x6acf4d51, 0x35b040a0, 0x73bf91ea, 0x3177f4ab, 0x579e48cc, 0x241608ab, 0x333e6a9e,
        0x0d495ddb, 0x6987b141, 0x18feffde, 0x2c91e2c2, 0x5dd6bff0, 0x5ce61d67, 0x779eb8b2, 0x54826cbb,
        0x3001ecb4, 0x154bcd9a, 0x3be72d2e, 0x5455873b, 0x09ab84d6, 0x438c6a8b, 0x45ffda0e, 0x1ce4c9c7,
    ],
    [
        0x35c8f2f0, 0x1dc40835, 0x756cc6f6, 0x0e146d08, 0x0ad9b699, 0x0541f6fa, 0x77b884d0, 0x17db8c98,
        0x59c7d04e, 0x3e0eba95, 0x2a28a66e, 0x60566879, 0x1ae1e397, 0x331e0750, 0x38d0f91e, 0x52fcf20d,
        0x4508cf06, 0x4826d030, 0x321f7db2, 0x022452ff, 0x375adcb4, 0x69b19019, 0x47442ecd, 0x0222de3d,
    ],
    [
        0x3b30e99a, 0x5b4c7207, 0x71d04e99, 0x1f02c78e, 0x73fc0cdc, 0x4bb751f9, 0x2474d1bc, 0x637b9b71,
        0x4766ad4f, 0x33060411, 0x2168b8b4, 0x4f15816e, 0x6ddacf2b, 0x0057c6ad, 0x5bfb91a9, 0x6027e02f,
        0x5d967a56, 0x139d4629, 0x41f6cc04, 0x240c7304, 0x131eba30, 0x0cd4affb, 0x72b01bef, 0x4ef7a632,
    ],
    [
        0x09478952, 0x6814a0f0, 0x72a61a71, 0x39bd9d86, 0x3ed1fbfc, 0x653afc45, 0x4c4ddb5d, 0x656b8199,
        0x686caf27, 0x5caf0289, 0x20e047b0, 0x736702e2, 0x1b46d6ed, 0x64cd8fdd, 0x475354f5, 0x59f199b8,
        0x32d5d81d, 0x2732f5f5, 0x09538182, 0x1c3ac6b0, 0x1f754ae0, 0x442a0cb1, 0x74ccefcd, 0x43013839,
    ],
]);

/// Create a default width-16 Poseidon1 for BabyBear using HorizenLabs constants.
pub fn default_babybear_poseidon1_16() -> Poseidon1BabyBear<16> {
    Poseidon::new(&PoseidonConstants {
        rounds_f: 8,
        rounds_p: 13,
        mds: BABYBEAR_POSEIDON1_MDS_16,
        round_constants: BABYBEAR_POSEIDON1_RC_16.to_vec(),
    })
}

/// Create a default width-24 Poseidon1 for BabyBear using HorizenLabs constants.
pub fn default_babybear_poseidon1_24() -> Poseidon1BabyBear<24> {
    Poseidon::new(&PoseidonConstants {
        rounds_f: 8,
        rounds_p: 21,
        mds: BABYBEAR_POSEIDON1_MDS_24,
        round_constants: BABYBEAR_POSEIDON1_RC_24.to_vec(),
    })
}

#[cfg(test)]
mod tests {
    use p3_field::PrimeCharacteristicRing;
    use p3_symmetric::Permutation;

    use super::*;

    type F = BabyBear;

    /// KAT: width-16, input = [0, 1, 2, ..., 15].
    /// Expected values from HorizenLabs reference implementation.
    #[test]
    fn test_poseidon1_width_16_sequential() {
        let perm = default_babybear_poseidon1_16();
        let mut input: [F; 16] =
            F::new_array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]);
        let expected: [F; 16] = F::new_array([
            778674657, 1825412997, 1640346271, 83951736, 1894025970, 447034218, 498444289,
            466682493, 1818143368, 1505239070, 1628058864, 946476541, 819595108, 1399158919,
            145448150, 196842266,
        ]);
        perm.permute_mut(&mut input);
        assert_eq!(input, expected);
    }

    /// KAT: width-16, input = all zeros.
    #[test]
    fn test_poseidon1_width_16_zeros() {
        let perm = default_babybear_poseidon1_16();
        let mut input = [F::ZERO; 16];
        let expected: [F; 16] = F::new_array([
            1492940447, 3933408, 2001701560, 379683329, 67896664, 1204605896, 205471985, 883149083,
            945520181, 639406069, 1422261663, 419361319, 1412338553, 1449184411, 1849064212,
            107987045,
        ]);
        perm.permute_mut(&mut input);
        assert_eq!(input, expected);
    }

    /// KAT: width-16, input = all ones.
    #[test]
    fn test_poseidon1_width_16_ones() {
        let perm = default_babybear_poseidon1_16();
        let mut input = [F::ONE; 16];
        let expected: [F; 16] = F::new_array([
            586998783, 161593044, 1930584191, 543842513, 1758528910, 1489291812, 637155264,
            346112516, 1643008824, 939438030, 939578557, 1062222570, 767076277, 152247659,
            859463755, 969690270,
        ]);
        perm.permute_mut(&mut input);
        assert_eq!(input, expected);
    }

    /// KAT: width-24, input = [0, 1, 2, ..., 23].
    #[test]
    fn test_poseidon1_width_24_sequential() {
        let perm = default_babybear_poseidon1_24();
        let mut input: [F; 24] = F::new_array([
            0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23,
        ]);
        let expected: [F; 24] = F::new_array([
            1571071959, 1834408751, 1984764921, 69529660, 852397151, 306510807, 2004352646,
            1955934214, 979858046, 1604998515, 1006773943, 51305430, 811845561, 871403888,
            1238331592, 849474360, 3883009, 1042969354, 448073154, 544474128, 1450924859,
            846284035, 1578364707, 1418221612,
        ]);
        perm.permute_mut(&mut input);
        assert_eq!(input, expected);
    }

    /// KAT: width-24, input = all zeros.
    #[test]
    fn test_poseidon1_width_24_zeros() {
        let perm = default_babybear_poseidon1_24();
        let mut input = [F::ZERO; 24];
        let expected: [F; 24] = F::new_array([
            1732814966, 1348956806, 1497259487, 1150858972, 1944109610, 599955066, 1259867441,
            1333489536, 208978614, 157174494, 1832557047, 1314764400, 1307336083, 1565301888,
            432427255, 1772111790, 900671786, 1882395262, 1677067075, 434690825, 1646828426,
            83897285, 120446341, 1725770573,
        ]);
        perm.permute_mut(&mut input);
        assert_eq!(input, expected);
    }

    /// KAT: width-24, input = all ones.
    #[test]
    fn test_poseidon1_width_24_ones() {
        let perm = default_babybear_poseidon1_24();
        let mut input = [F::ONE; 24];
        let expected: [F; 24] = F::new_array([
            102990370, 712382576, 533631375, 1021240238, 1898683445, 1133193200, 1294760435,
            1616827733, 664509130, 1164005802, 1150915675, 39124447, 362356636, 519069899,
            781422363, 532159342, 2010544060, 1663219686, 662365586, 953574691, 357037989,
            1506430641, 1567931341, 1796952637,
        ]);
        perm.permute_mut(&mut input);
        assert_eq!(input, expected);
    }

    /// Test determinism: same input always gives same output.
    #[test]
    fn test_poseidon1_width_16_deterministic() {
        let perm = default_babybear_poseidon1_16();
        let input: [F; 16] = core::array::from_fn(|i| F::from_u32(i as u32 + 42));

        let mut output1 = input;
        perm.permute_mut(&mut output1);

        let mut output2 = input;
        perm.permute_mut(&mut output2);

        assert_eq!(output1, output2);
    }

    /// Test determinism: same input always gives same output (width 24).
    #[test]
    fn test_poseidon1_width_24_deterministic() {
        let perm = default_babybear_poseidon1_24();
        let input: [F; 24] = core::array::from_fn(|i| F::from_u32(i as u32 + 42));

        let mut output1 = input;
        perm.permute_mut(&mut output1);

        let mut output2 = input;
        perm.permute_mut(&mut output2);

        assert_eq!(output1, output2);
    }
}
